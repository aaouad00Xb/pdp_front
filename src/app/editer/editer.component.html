
<div class="content"  >

    <!-- Compact Header -->
    <div class="header-container">
      <div class="header-bar bar">
        <div class="header-content">
          <!-- Left Logo -->
          <div class="logo-section">
            <img [src]="currentLeftLogo" alt="Logo Principal" class="header-logo-left">
          </div>
          
          <!-- Title Section -->
          <div class="title-section">
            <h1 class="header-title">{{ getCurrentTitle() }}</h1>
          </div>
          
          <!-- Controls Section -->
          <div class="controls-section">
            <div class="language-toggle-wrapper">
              <app-language-toggle></app-language-toggle>
            </div>
            <div class="logo-section">
              <img [src]="currentRightLogo" alt="Logo Secondaire" class="header-logo-right">
            </div>
      </div>
      </div>
      </div>
      
      <!-- Navigation Bar -->
      <div class="nav-bar">
        <div class="nav-content">
          <span class="nav-title">{{ 'nav.editor' | translate }}</span>
          <button class="btn btn-cancel" [routerLink]="['/dashboard']">
            <i class="bi bi-arrow-left"></i>
            {{ 'common.cancel' | translate }}
          </button>
        </div>
      </div>
    </div>
  
     </div>
   
   
   
    <div class="container">
        <!-- Tab Navigation -->
        <ul class="nav nav-tabs mb-4">
          <li class="nav-item">
            <button class="nav-link" 
                    [class.active]="activeTab === 'table'"
                    (click)="activeTab = 'table'">
              <i class="bi bi-table"></i> {{ 'editor.dataTab' | translate }}
            </button>
          </li>
          <li class="nav-item" *ngIf="isAdmin">
            <button class="nav-link" 
                    [class.active]="activeTab === 'import'"
                    (click)="activeTab = 'import'">
              <i class="bi bi-cloud-upload"></i> {{ 'editor.importTab' | translate }}
            </button>
          </li>
          <li class="nav-item" *ngIf="isAdmin">
            <button class="nav-link" 
                    [class.active]="activeTab === 'settings'"
                    (click)="activeTab = 'settings'">
              <i class="bi bi-gear"></i> {{ 'editor.settingsTab' | translate }}
            </button>
          </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content">
          
          <!-- Debug info -->
          <div class="alert alert-info mb-3">
            <small>Active Tab: {{activeTab}} | Data Length: {{data?.length || 0}}</small>
        </div>

          <!-- Table Management Tab -->
          <div *ngIf="activeTab === 'table'">
           
 

            <!-- Minimal Action Toolbar -->
            <div class="action-toolbar">
              <div class="btn-group gap-2">
                <button class="btn btn-outline-primary btn-sm" (click)="add()">
                  <i class="bi bi-plus-circle me-1"></i>
                  <span class="d-none d-sm-inline">{{ 'editor.addRow' | translate }}</span>
                </button>
                <button class="btn btn-outline-success btn-sm" (click)="exportTableToExcel()">
                  <i class="bi bi-file-earmark-spreadsheet me-1"></i>
                  <span class="d-none d-sm-inline">{{ 'editor.exportExcel' | translate }}</span>
                </button>
              </div>

              <div class="action-stats">
                <span class="stat-item"><i class="bi bi-info-circle me-1"></i>{{ 'editor.totalRecords' | translate }}: <strong>{{data?.length || 0}}</strong></span>
                <span class="sep">•</span>
                <span class="stat-item"><i class="bi bi-funnel me-1"></i>{{ 'editor.filtered' | translate }}: <strong>{{getAllFilteredData().length}}</strong></span>
              </div>
            </div>

            <!-- Simple Filters -->
            <div class="filters-section mb-3">
              <div class="row">
                <div class="col-md-2">
                  <input type="text" class="form-control form-control-sm" [(ngModel)]="filters.id" [placeholder]="('editor.filterById' | translate)">
                </div>
                <div class="col-md-2">
                  <input type="text" class="form-control form-control-sm" [(ngModel)]="filters.axes" [placeholder]="('fields.axes' | translate) + ' (FR)'">
                </div>
                <div class="col-md-2">
                  <input type="text" class="form-control form-control-sm" [(ngModel)]="filters.axes_ar" [placeholder]="('fields.axes' | translate)" dir="rtl">
                </div>
                <div class="col-md-2">
                  <input type="text" class="form-control form-control-sm" [(ngModel)]="filters.objectif" [placeholder]="('fields.objectif' | translate) + ' (FR)'">
                </div>
                <div class="col-md-2">
                  <input type="text" class="form-control form-control-sm" [(ngModel)]="filters.objectif_ar" [placeholder]="('fields.objectif' | translate)" dir="rtl">
                </div>
                <div class="col-md-2">
                  <select class="form-control form-control-sm" [(ngModel)]="filters.annee_realisation">
                    <option value="">{{ 'editor.allYears' | translate }}</option>
                    <option value="2022">2022</option>
                    <option value="2023">2023</option>
                    <option value="2024">2024</option>
                    <option value="2025">2025</option>
                    <option value="2026">2026</option>
                    <option value="2027">2027</option>
                  </select>
                </div>
              </div>
              <div class="row mt-2">
                <div class="col-md-2">
                  <input type="text" class="form-control form-control-sm" [(ngModel)]="filters.projet_action" [placeholder]="('fields.projetAction' | translate) + ' (FR)'">
                </div>
                <div class="col-md-2">
                  <input type="text" class="form-control form-control-sm" [(ngModel)]="filters.projet_action_ar" [placeholder]="('fields.projetAction' | translate)" dir="rtl">
                </div>
                <div class="col-md-2">
                  <button class="btn btn-secondary btn-sm" (click)="clearFilters()">
                    <i class="bi bi-x-circle"></i> {{ 'common.clear' | translate }}
                  </button>
                </div>
                <div class="col-md-6 text-right">
                  <small class="text-muted">
                    {{ 'editor.showing' | translate }} {{getStartIndex()}}-{{getEndIndex()}} {{ 'editor.of' | translate }} {{getAllFilteredData().length}} {{ 'editor.items' | translate }}
                  </small>
                </div>
              </div>
        </div>

            <!-- Data Table -->
            <div class="table-container-scrollable">
              <div class="table-responsive table-scroll">
                <table id="customers-simple" class="table table-striped table-fixed" #exportTable>
        <thead>
          <tr>
                      <th colspan="14">{{ 'editor.title' | translate }}</th>
          </tr>
          <tr>
                      <th class="sortable" (click)="sortBy('id')">
                        ID <i class="bi" [ngClass]="getSortIcon('id')"></i>
                      </th>
                      <th class="french-col sortable" (click)="sortBy('axes')">
                        {{ 'fields.axes' | translate }} (FR) <i class="bi" [ngClass]="getSortIcon('axes')"></i>
                      </th>
                      <th class="arabic-col sortable" (click)="sortBy('axes_ar')">
                        {{ 'fields.axes' | translate }} (AR) <i class="bi" [ngClass]="getSortIcon('axes_ar')"></i>
                      </th>
                      <th class="french-col sortable" (click)="sortBy('objectif')">
                        {{ 'fields.objectif' | translate }} (FR) <i class="bi" [ngClass]="getSortIcon('objectif')"></i>
                      </th>
                      <th class="arabic-col sortable" (click)="sortBy('objectif_ar')">
                        {{ 'fields.objectif' | translate }} (AR) <i class="bi" [ngClass]="getSortIcon('objectif_ar')"></i>
                      </th>
                      <th class="french-col sortable" (click)="sortBy('projet_action')">
                        {{ 'fields.projetAction' | translate }} (FR) <i class="bi" [ngClass]="getSortIcon('projet_action')"></i>
                      </th>
                      <th class="arabic-col sortable" (click)="sortBy('projet_action_ar')">
                        {{ 'fields.projetAction' | translate }} (AR) <i class="bi" [ngClass]="getSortIcon('projet_action_ar')"></i>
                      </th>
                      <th class="sortable" (click)="sortBy('cout_estime')">
                        {{ 'fields.coutEstime' | translate }} <i class="bi" [ngClass]="getSortIcon('cout_estime')"></i>
                      </th>
                      <th class="sortable" (click)="sortBy('part_conseil_prefectoral')">
                        {{ 'fields.partConseilPrefectoral' | translate }} <i class="bi" [ngClass]="getSortIcon('part_conseil_prefectoral')"></i>
                      </th>
                      <th class="sortable" (click)="sortBy('part_partenaire')">
                        {{ 'fields.partPartenaire' | translate }} <i class="bi" [ngClass]="getSortIcon('part_partenaire')"></i>
                      </th>
                      <th class="sortable" (click)="sortBy('annee_realisation')">
                        {{ 'fields.anneeRealisation' | translate }} <i class="bi" [ngClass]="getSortIcon('annee_realisation')"></i>
                      </th>
                      <th class="sortable" (click)="sortBy('realise')">
                        {{ 'fields.realise' | translate }} <i class="bi" [ngClass]="getSortIcon('realise')"></i>
                      </th>
                      <th class="sortable" (click)="sortBy('taux_realisation_physique')">
                        {{ 'fields.tauxRealisationPhysique' | translate }} <i class="bi" [ngClass]="getSortIcon('taux_realisation_physique')"></i>
                      </th>
                      <th>Actions</th>
          </tr>
        </thead>
        <tbody>
                      <tr *ngFor="let ele of getFilteredData()" [ngClass]="{'table-warning': ele.expanded}">
                        <td>{{ele.id}}</td>
                        
                        <!-- French Axes -->
                        <td class="french-cell" *ngIf="!ele.expanded">{{ele.axes}}</td>
                        <td class="french-cell" *ngIf="ele.expanded">
                          <textarea class="form-control form-control-sm textarea-edit" [(ngModel)]="ele.axes" rows="3"></textarea>
                        </td>
                        
                        <!-- Arabic Axes -->
                        <td class="arabic-cell" *ngIf="!ele.expanded">{{ele.axes_ar}}</td>
                        <td class="arabic-cell" *ngIf="ele.expanded">
                          <textarea class="form-control form-control-sm textarea-edit" [(ngModel)]="ele.axes_ar" dir="rtl" rows="3"></textarea>
                        </td>
                        
                        <!-- French Objectif -->
                        <td class="french-cell" *ngIf="!ele.expanded">{{ele.objectif}}</td>
                        <td class="french-cell" *ngIf="ele.expanded">
                          <textarea class="form-control form-control-sm textarea-edit" [(ngModel)]="ele.objectif" rows="3"></textarea>
                        </td>
                        
                        <!-- Arabic Objectif -->
                        <td class="arabic-cell" *ngIf="!ele.expanded">{{ele.objectif_ar}}</td>
                        <td class="arabic-cell" *ngIf="ele.expanded">
                          <textarea class="form-control form-control-sm textarea-edit" [(ngModel)]="ele.objectif_ar" dir="rtl" rows="3"></textarea>
                        </td>
                        
                        <!-- French Projet Action -->
                        <td class="french-cell" *ngIf="!ele.expanded">{{ele.projet_action}}</td>
                        <td class="french-cell" *ngIf="ele.expanded">
                          <textarea class="form-control form-control-sm textarea-edit" [(ngModel)]="ele.projet_action" rows="3"></textarea>
                        </td>
                        
                        <!-- Arabic Projet Action -->
                        <td class="arabic-cell" *ngIf="!ele.expanded">{{ele.projet_action_ar}}</td>
                        <td class="arabic-cell" *ngIf="ele.expanded">
                          <textarea class="form-control form-control-sm textarea-edit" [(ngModel)]="ele.projet_action_ar" dir="rtl" rows="3"></textarea>
                        </td>

                        <!-- Numeric Fields -->
                        <td *ngIf="!ele.expanded">{{ele.cout_estime}}</td>
                        <td *ngIf="ele.expanded">
                          <input type="number" class="form-control form-control-sm" [(ngModel)]="ele.cout_estime">
                        </td>

                        <td *ngIf="!ele.expanded">{{ele.part_conseil_prefectoral}}</td>
                        <td *ngIf="ele.expanded">
                          <input type="number" class="form-control form-control-sm" [(ngModel)]="ele.part_conseil_prefectoral">
                        </td>

                        <td *ngIf="!ele.expanded">{{ele.part_partenaire}}</td>
                        <td *ngIf="ele.expanded">
                          <input type="number" class="form-control form-control-sm" [(ngModel)]="ele.part_partenaire">
                        </td>

                        <td *ngIf="!ele.expanded">{{ele.annee_realisation}}</td>
                        <td *ngIf="ele.expanded">
                          <input type="number" class="form-control form-control-sm" [(ngModel)]="ele.annee_realisation">
                        </td>
                         
                        <td *ngIf="!ele.expanded">{{ele.realise}}</td>
                        <td *ngIf="ele.expanded">
                          <input type="number" class="form-control form-control-sm" [(ngModel)]="ele.realise">
                        </td>

                        <td *ngIf="!ele.expanded">{{ele.taux_realisation_physique}}%</td>
                        <td *ngIf="ele.expanded">
                          <input type="number" class="form-control form-control-sm" [(ngModel)]="ele.taux_realisation_physique">
                        </td>

                        <!-- Actions -->
                        <td>
                          <button *ngIf="ele.expanded && !ele.id" class="btn btn-success btn-sm me-1" 
                                  (click)="addnew();ele.expanded = !ele.expanded;">
                            <i class="bi bi-check"></i>
                          </button>
                          <button *ngIf="ele.expanded && ele.id" class="btn btn-success btn-sm me-1" 
                                  (click)="updaterow();ele.expanded = !ele.expanded;">
                            <i class="bi bi-check"></i>
                          </button>
                          <button *ngIf="ele.id && !ele.expanded" class="btn btn-primary btn-sm me-1" 
                                  (click)="ele.expanded = !ele.expanded;selectedrow = ele">
                            <i class="bi bi-pencil"></i>
                          </button>
                          <button *ngIf="ele.id && !ele.expanded" class="btn btn-danger btn-sm" 
                                  (click)="selectedrow = ele;verify()">
                            <i class="bi bi-trash"></i>
                          </button>
              </td>
            </tr>
        </tbody>
      </table>
</div>
            </div>

            <!-- Pagination Controls -->
            <div class="pagination-section mt-3" *ngIf="getTotalPages() > 1">
              <nav aria-label="Table pagination">
                <ul class="pagination justify-content-center mb-0">
                  <!-- Previous Button -->
                  <li class="page-item" [class.disabled]="currentPage === 1">
                    <button class="page-link" (click)="previousPage()" [disabled]="currentPage === 1">
                      <i class="bi bi-chevron-left"></i> Précédent
                    </button>
                  </li>
                  
                  <!-- Page Numbers -->
                  <li class="page-item" 
                      *ngFor="let page of getPageNumbers()" 
                      [class.active]="page === currentPage">
                    <button class="page-link" (click)="goToPage(page)">
                      {{page}}
                    </button>
                  </li>
                  
                  <!-- Next Button -->
                  <li class="page-item" [class.disabled]="currentPage === getTotalPages()">
                    <button class="page-link" (click)="nextPage()" [disabled]="currentPage === getTotalPages()">
                      Suivant <i class="bi bi-chevron-right"></i>
                    </button>
                  </li>
                </ul>
              </nav>
              
              <!-- Pagination Info -->
              <div class="text-center mt-2">
                <small class="text-muted">
                  Page {{currentPage}} sur {{getTotalPages()}} 
                  ({{getAllFilteredData().length}} éléments au total)
                </small>
              </div>
            </div>
          </div>

          <!-- Import Excel Tab -->
          <div *ngIf="activeTab === 'import' && isAdmin">
            <h3>Import Excel Content</h3>
            <p>This is the import tab content.</p>
            
            <div class="upload-section">
              <div class="card">
                <div class="card-header">
                  <h5 class="mb-0"><i class="bi bi-cloud-upload"></i> {{ 'editor.importTab' | translate }}</h5>
                </div>
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-6">
                      <label class="form-label">{{ 'editor.uploadExcelLabel' | translate }}</label>
                      <input type="file" 
                             class="form-control" 
                             accept=".xlsx,.xls" 
                             (change)="onFileSelected($event)"
                             #fileInput>
                      <small class="text-muted">{{ 'editor.acceptedFormats' | translate }}</small>
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">{{ 'editor.downloadTemplate' | translate }}</label>
                      <br>
                      <button class="btn btn-outline-info btn-sm" (click)="downloadTemplate()">
                        <i class="bi bi-download"></i> {{ 'editor.downloadTemplateBtn' | translate }}
                      </button>
                      <small class="d-block text-muted mt-1">{{ 'editor.templateHint' | translate }}</small>
                    </div>
                  </div>
                  
                  <div class="mt-3" *ngIf="uploadProgress > 0">
                    <div class="progress">
                      <div class="progress-bar" 
                           [style.width.%]="uploadProgress" 
                           [ngClass]="{'bg-success': uploadProgress === 100, 'bg-info': uploadProgress < 100}">
                        {{uploadProgress}}%
                      </div>
                    </div>
                    <small class="text-muted">{{uploadStatus}}</small>
                  </div>

                  <div class="mt-3" *ngIf="selectedFile">
                    <div class="alert alert-info">
                      <strong>{{ 'editor.selectedFile' | translate }}:</strong> {{selectedFile.name}} ({{getFileSize(selectedFile.size)}})
                      <button class="btn btn-success btn-sm ms-2" (click)="uploadFile()" [disabled]="uploading">
                        <i class="bi bi-upload"></i> 
                        <span *ngIf="!uploading">{{ 'editor.import' | translate }}</span>
                        <span *ngIf="uploading">{{ 'editor.importing' | translate }}</span>
                      </button>
                      <button class="btn btn-secondary btn-sm ms-1" (click)="clearFile()">
                        <i class="bi bi-x"></i> {{ 'common.cancel' | translate }}
                      </button>
                    </div>
                  </div>

                  <!-- Instructions -->
                  <div class="mt-4">
                    <h6><i class="bi bi-info-circle"></i> {{ 'editor.instructions' | translate }}</h6>
                    <ol class="small text-muted">
                      <li>{{ 'editor.step1' | translate }}</li>
                      <li>{{ 'editor.step2' | translate }}</li>
                      <li>{{ 'editor.step3' | translate }}</li>
                      <li>{{ 'editor.step4' | translate }}</li>
                    </ol>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Settings Tab -->
          <div *ngIf="activeTab === 'settings' && isAdmin">
            <div class="settings-section">
              <h3><i class="bi bi-gear"></i> {{ 'editor.appSettings' | translate }}</h3>
              
              <!-- Logo Settings -->
              <div class="card mb-4">
                <div class="card-header">
                  <h5><i class="bi bi-image"></i> {{ 'editor.logoManagement' | translate }}</h5>
                </div>
                <div class="card-body">
                  <div class="row">
                    <!-- Left Logo -->
                    <div class="col-md-6">
                      <h6>{{ 'editor.leftLogo' | translate }}</h6>
                      <div class="logo-preview mb-3">
                        <img [src]="currentLeftLogo" alt="Logo Principal" class="img-thumbnail" style="max-width: 150px; max-height: 100px;">
                      </div>
                      <div class="mb-3">
                        <label for="leftLogoFile" class="form-label">{{ 'editor.changeLeftLogo' | translate }}</label>
                        <input type="file" 
                               class="form-control" 
                               id="leftLogoFile" 
                               accept="image/*"
                               (change)="onLeftLogoSelected($event)">
                      </div>
                      <button class="btn btn-primary btn-sm" 
                              [disabled]="!selectedLeftLogo"
                              (click)="uploadLeftLogo()">
                        <i class="bi bi-upload"></i> {{ 'common.update' | translate }}
                      </button>
                    </div>
                    
                    <!-- Right Logo -->
                    <div class="col-md-6">
                      <h6>{{ 'editor.rightLogo' | translate }}</h6>
                      <div class="logo-preview mb-3">
                        <img [src]="currentRightLogo" alt="Logo Secondaire" class="img-thumbnail" style="max-width: 150px; max-height: 100px;">
                      </div>
                      <div class="mb-3">
                        <label for="rightLogoFile" class="form-label">{{ 'editor.changeRightLogo' | translate }}</label>
                        <input type="file" 
                               class="form-control" 
                               id="rightLogoFile" 
                               accept="image/*"
                               (change)="onRightLogoSelected($event)">
                      </div>
                      <button class="btn btn-primary btn-sm" 
                              [disabled]="!selectedRightLogo"
                              (click)="uploadRightLogo()">
                        <i class="bi bi-upload"></i> {{ 'common.update' | translate }}
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Title Settings -->
              <div class="card mb-4">
                <div class="card-header">
                  <h5><i class="bi bi-type"></i> {{ 'editor.titleManagement' | translate }}</h5>
                </div>
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-6">
                      <div class="mb-3">
                        <label for="titleFr" class="form-label">{{ 'editor.titleFr' | translate }}</label>
                        <textarea class="form-control" 
                                  id="titleFr" 
                                  rows="3" 
                                  [(ngModel)]="appSettings.titleFr"
                                  placeholder="Programme de Développement Préfectoral de Rabat">
                        </textarea>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="mb-3">
                        <label for="titleAr" class="form-label">{{ 'editor.titleAr' | translate }}</label>
                        <textarea class="form-control" 
                                  id="titleAr" 
                                  rows="3" 
                                  dir="rtl"
                                  [(ngModel)]="appSettings.titleAr"
                                  placeholder="برنامج التنمية الإقليمية للرباط">
                        </textarea>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Title Preview -->
                  <div class="title-preview mb-3">
                    <h6>{{ 'editor.titlePreview' | translate }}</h6>
                    <div class="preview-box p-3 border rounded" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                      <div class="row align-items-center">
                        <div class="col-2 text-center">
                          <img [src]="currentLeftLogo" width="60px" alt="Logo" class="img-fluid">
                        </div>
                        <div class="col-8 text-center">
                          <h4 class="mb-0" style="font-family: 'Tahoma', sans-serif;">
                            {{ getCurrentTitle() }}
                          </h4>
                        </div>
                        <div class="col-2 text-center">
                          <img [src]="currentRightLogo" width="40px" alt="Logo" class="img-fluid">
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <button class="btn btn-success" (click)="saveAppSettings()">
                    <i class="bi bi-check-circle"></i> {{ 'editor.saveSettings' | translate }}
                  </button>
                </div>
</div>
    
              <!-- Reset Settings -->
              <div class="card">
                <div class="card-header">
                  <h5><i class="bi bi-arrow-clockwise"></i> {{ 'editor.reset' | translate }}</h5>
                </div>
                <div class="card-body">
                  <p class="text-muted">{{ 'editor.resetHint' | translate }}</p>
                  <button class="btn btn-warning" (click)="resetToDefaults()">
                    <i class="bi bi-arrow-clockwise"></i> {{ 'editor.resetToDefaults' | translate }}
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
    </div>